# План имплементации Enoki для спонсирования транзакций

## Анализ текущего состояния проекта

### Что уже реализовано:
1. **Базовая структура NFT Factory** - Move контракт для создания коллекций и минтинга NFT
2. **Frontend приложение** - React + TypeScript с использованием @mysten/dapp-kit
3. **Интеграция с Sui** - подключение к testnet, работа с кошельками
4. **Базовая структура Enoki** - файл `src/lib/enoki.ts` с заглушками

### Что нужно доработать:
1. **Полная интеграция с Enoki API** - замена заглушек на реальные вызовы
2. **Спонсирование транзакций** - все операции должны проходить через Enoki
3. **Обработка ошибок** - правильная обработка ответов от Enoki API
4. **Конфигурация** - настройка переменных окружения

## Детальный план имплементации

### 1. Настройка переменных окружения

#### 1.1 Создать файл `.env.local`
```env
# Enoki Configuration
VITE_ENOKI_API_KEY=your_enoki_api_key_here
VITE_ENOKI_BASE_URL=https://api.enoki.network/v1

# Sui Configuration  
VITE_SUI_NETWORK=testnet
VITE_NFT_FACTORY_PACKAGE_ID=0xd8004005f0860cf71b1278cb32c60fbe307b31dedc80bc1708869015d33e16d3
VITE_GLOBAL_STATE_OBJECT_ID=0x92da41eff3d36845f6bf63f05311345272d7eb417f885db0ef527c6889f12f01
```

#### 1.2 Обновить `.gitignore`
- Добавить `.env.local` в игнорируемые файлы

### 2. Доработка Enoki клиента

#### 2.1 Исправить сериализацию транзакций
- Заменить заглушку `placeholder_serialized_transaction` на реальную сериализацию
- Использовать `transactionBlock.serialize()` из @mysten/sui

#### 2.2 Добавить правильную обработку ответов
- Реализовать парсинг ответов от Enoki API
- Добавить валидацию ответов

#### 2.3 Улучшить обработку ошибок
- Добавить специфичные типы ошибок для Enoki
- Реализовать retry логику для временных сбоев

### 3. Интеграция спонсирования в контракт

#### 3.1 Обновить `NFTFactoryContract`
- Заменить прямые вызовы `signAndExecute` на спонсированные транзакции
- Добавить методы для работы с Enoki

#### 3.2 Создать wrapper для спонсированных транзакций
- Метод `executeSponsoredTransaction` в `contract.ts`
- Интеграция с существующими методами `createCollection` и `mintEdition`

### 4. Обновление хуков и компонентов

#### 4.1 Модификация `useNFTMinting`
- Заменить `signTransactionBlock` на спонсированные транзакции
- Добавить обработку статуса спонсирования

#### 4.2 Обновление `useCollections`
- Интегрировать спонсирование для создания коллекций

### 5. UI/UX улучшения

#### 5.1 Индикаторы спонсирования
- Показывать статус спонсирования транзакций
- Добавить индикаторы загрузки для Enoki операций

#### 5.2 Обработка ошибок
- Показывать понятные сообщения об ошибках Enoki
- Добавить возможность retry для failed транзакций

### 6. Тестирование и валидация

#### 6.1 Unit тесты
- Тесты для Enoki клиента
- Тесты для спонсированных транзакций

#### 6.2 Интеграционные тесты
- Тестирование полного flow с Enoki
- Валидация на testnet

## Технические детали

### Архитектура спонсирования:
```
User Action → Create Transaction → Serialize → Send to Enoki → 
Enoki Sponsors → Execute on Sui → Return Result → Update UI
```

### Ключевые файлы для изменения:
1. `src/lib/enoki.ts` - основная логика Enoki
2. `src/lib/contract.ts` - интеграция спонсирования
3. `src/hooks/useNFTMinting.ts` - использование спонсирования
4. `src/hooks/useCollections.ts` - спонсирование создания коллекций
5. `.env.local` - конфигурация

### API Endpoints Enoki:
- `POST /sponsor` - спонсирование транзакции
- `GET /transaction/{digest}` - статус транзакции
- `GET /user/{address}/transactions` - история транзакций пользователя

## Ожидаемые результаты

После имплементации:
1. ✅ Все транзакции будут спонсироваться через Enoki
2. ✅ Пользователи не будут платить gas fees
3. ✅ Улучшенный UX с индикаторами статуса
4. ✅ Надежная обработка ошибок
5. ✅ Полная совместимость с существующим функционалом

## Временные рамки

- **Настройка окружения**: 30 минут
- **Доработка Enoki клиента**: 2-3 часа  
- **Интеграция в контракт**: 2-3 часа
- **Обновление UI/UX**: 1-2 часа
- **Тестирование**: 1-2 часа

**Общее время**: 6-10 часов

## Риски и митигация

### Риски:
1. **API изменения Enoki** - документировать версии API
2. **Лимиты спонсирования** - добавить fallback на обычные транзакции
3. **Сетевые проблемы** - реализовать retry логику

### Митигация:
1. Версионирование API вызовов
2. Graceful degradation при недоступности Enoki
3. Comprehensive error handling и logging
